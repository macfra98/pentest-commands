#!/bin/bash

ALIAS_PATH=$(pwd)
CURR_SHELL="bash"
RC_FILE=".$CURR_SHELL"rc

if [[ $EUID -eq 0 ]]; then
    WHO_AM_I="$SUDO_USER"
else
    WHO_AM_I=$(whoami)
    if [ "$(stat -c '%U' "$ALIAS_PATH/.bash_installs")" == "$WHO_AM_I" ]; then
        printf '%b' "\033[1;32m[+]\033[0m You are the owner of this file: $ALIAS_PATH/.bash_installs\n"
    else
        printf '%b' "\033[1;31m[-]\033[0m You are not the owner of this file: $ALIAS_PATH/.bash_installs\n"
        printf '%b' "\033[1;33m[!]\033[0m Maybe you should try running it with sudo?\n"
        exit
    fi
fi

RC_FILE_LOCATION="/home/$WHO_AM_I"

printf '%b' "\033[1;32m[+]\033[0m The current shell is $CURR_SHELL\n"

# aliases to be added to the rc file
alias_array=(
"alias common=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/common)\\\"\""
"alias active=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/active)\\\"\""
"alias passive=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/passive)\\\"\""
"alias winchecks=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/winchecks)\\\"\""
"alias revshells=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/revshells)\\\"\""
"alias linhold=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/linux/linhold)\\\"\""
"alias ttys=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/linux/ttys)\\\"\""
"alias linesc=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/linux/linesc)\\\"\""
"alias kernsploit=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/linux/kernsploit)\\\"\""
"alias lintran=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/linux/lintran)\\\"\""
"alias lintun=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/linux/lintun)\\\"\""
"alias lincom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/linux/lincom)\\\"\""
"alias wintran=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/windows/wintran)\\\"\""
"alias wintun=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/windows/wintun)\\\"\""
"alias winhold=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/windows/winhold)\\\"\""
"alias winesc=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/windows/winesc)\\\"\""
"alias wincom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/windows/wincom)\\\"\""
"alias powercom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/windows/powercom)\\\"\""
"alias brutecom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/tools/brutecom)\\\"\""
"alias cmecom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/tools/cmecom)\\\"\""
"alias mailcom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/services/mailcom)\\\"\""
"alias ficom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/webapp/ficom)\\\"\""
"alias sqlicom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/webapp/sqlicom)\\\"\""
"alias bugcom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/webapp/bugcom)\\\"\""
"alias fuzzcom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/webapp/fuzzcom)\\\"\""
"alias nmapcom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/tools/nmapcom)\\\"\""
"alias msfcom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/tools/msfcom)\\\"\""
"alias expcom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/tools/expcom)\\\"\""
"alias attactive=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/tools/attacktive)\\\"\""
"alias passcom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/tools/passcom)\\\"\""
"alias crackcom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/tools/crackcom)\\\"\""
"alias hashcom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/tools/hashcom)\\\"\""
"alias zipcom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/tools/zipcom)\\\"\""
"alias impcom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/tools/impcom)\\\"\""
"alias mitmcom=\"printf '%b' \\\"\\\$(/usr/bin/cat $ALIAS_PATH/commands/tools/mitmcom)\\\"\""
"alias commands=\"/usr/bin/python3 $ALIAS_PATH/helper/guide.py\""
)

file_path="$RC_FILE_LOCATION/$RC_FILE"

# check if rc file exists, if it doesn't add, else ignore.
if [ -e "$file_path" ]; then
    printf '%b' "\033[1;32m[+]\033[0m rc file exists, continueing.\n"
else
    printf '%b' "\033[1;31m[-]\033[0m rc file does not exist, adding it.\n"
    touch "$file_path"
fi

printf '%b' "\033[1;33m[!]\033[0m Creating a backup of existing $RC_FILE\n"
cp "$file_path" "$file_path.bak"

if [ -e "$file_path" ]; then
    printf '%b' "\033[1;33m[!] \033[0mRC_PATH: $file_path\n"
    tmp_file="tmpfile"

    for element in "${alias_array[@]}"; do
        if ! grep -qF "$element" "$file_path"; then
            printf '%b' "\033[1;32m[+]\033[0m Prepending $element to $file_path\n"
            echo "$element" | cat - "$file_path" > "$tmp_file"
            if [[ $EUID -eq 0 ]]; then
            # Script is running with sudo
                current_user="$SUDO_USER"
                chown $current_user:$current_user $tmp_file
                mv "$tmp_file" "$file_path"
            else
            # Script is not running with sudo
                chown $USER:$USER $tmp_file
                mv "$tmp_file" "$file_path"
            fi
        else
            printf '%b' "\033[1;33m[!]\033[0m A line already exists in $file_path, skipping.\n"
        fi
    done

    printf '%b' "\033[1;32m[+]\033[0m Sourcing the updated file $file_path\n"
    . "$file_path"

    printf '%b' "\033[5;33m[!]\033[0m If you still can't use the aliases you might need to open a new terminal\n"
else
    printf '%b' "\033[1;35m[!]\033[0m The file you're trying to append to does not exist!\n"
    exit
fi
